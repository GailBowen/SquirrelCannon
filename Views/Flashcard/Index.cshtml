

@model IEnumerable<SquirrelCannon.Models.Flashcard>

<div class="container">
    <h2>Today's Flashcards</h2>

    @if (!Model.Any())
    {
        <div class="alert alert-info">
            No cards to review today!
        </div>
    }
    else
    {
        <div id="progress" class="mb-3">
            Card <span id="currentCardNumber">1</span> of <span id="totalCards">@Model.Count()</span>
        </div>

        <div id="flashcard-deck">
        @foreach (var card in Model)
        {
            <div class="card mb-3 flashcard-container" data-answer="@card.Answer.ToLower()">
                <div class="card-body">
                    <h5 class="card-title">@card.Question</h5>

                    <div class="answer-section">
                        <div class="mb-3">
                            <input type="text" class="form-control answer-input" placeholder="Type your answer here">
                            <button class="btn btn-primary mt-2 check-answer">Check Answer</button>
                        </div>

                        <div class="answer-result" style="display:none;">
                            <div class="correct-answer" style="display:none;">
                                <p class="text-success">Correct! The answer is: @card.Answer</p>
                            </div>
                            <div class="wrong-answer" style="display:none;">
                                <p class="text-danger">Incorrect. The correct answer is: @card.Answer</p>
                            </div>

                            <div class="response-buttons">
                                <form asp-action="Review" method="post">
                                    <input type="hidden" name="id" value="@card.Id" />
                                    <input type="hidden" name="correct" class="correct-flag" value="false" />
                                    <button type="submit" class="btn btn-primary next-card">Next Card →</button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        }
        </div>


    }
</div>


    <script>
      
        document.addEventListener('DOMContentLoaded', function() {
            const cards = document.querySelectorAll('.flashcard-container');
            let currentCardIndex = 0;

            //Hide all cards initially
            cards.forEach(card => {
                card.style.display = 'none';
            });

            function showCard(index) {
                // Hide all cards
                cards.forEach(card => {
                    card.style.display = 'none';
                    
                    const answerInput = card.querySelector('.answer-input');

                    if (answerInput) answerInput.value = '';

                    const checkButton = card.querySelector('.check-answer');

                    if (checkButton) checkButton.style.display = 'block';

                    const answerResult = card.querySelector('.answer-result');

                    if (answerResult) answerResult.style.display = 'none';
                
                });

                // Show current card if it exists
                if (index < cards.length) {
                    cards[index].style.display = 'block';
                   
                    const input = cards[index].querySelector('.answer-input');
                    if (input) { 
                        input.value = '';
                        input.focus();
                    }
                }
            }

            // Show first card initially
            showCard(0);

            // Handle checking answers
            document.querySelectorAll('.check-answer').forEach(button => {
                button.addEventListener('click', function() {
                    const container = this.closest('.card-body');
                    const cardContainer = this.closest('.flashcard-container');
                    const userAnswer = container.querySelector('.answer-input').value.trim().toLowerCase();
                    const correctAnswer = cardContainer.getAttribute('data-answer');
                    const resultSection = container.querySelector('.answer-result');
                    const correctDiv = container.querySelector('.correct-answer');
                    const wrongDiv = container.querySelector('.wrong-answer');
                    const correctFlag = container.querySelector('.correct-flag');

                    resultSection.style.display = 'block';
                    if (userAnswer === correctAnswer) {
                        correctDiv.style.display = 'block';
                        wrongDiv.style.display = 'none';
                        correctFlag.value = 'true';
                    } else {
                        correctDiv.style.display = 'none';
                        wrongDiv.style.display = 'block';
                        correctFlag.value = 'false';
                    }

                    container.querySelector('.response-buttons').style.display = 'block';
                    this.style.display = 'none';
                });
            });

            // Add event listeners to next card buttons
            document.querySelectorAll('.next-card').forEach(button => {
                button.addEventListener('click', function(e) {
                    e.preventDefault(); // Prevent form submission

                    // Get the form and submit it
                    const form = this.closest('form');
                    fetch(form.action, {
                        method: 'POST',
                        body: new FormData(form)
                    });

                    currentCardIndex++;
                    if (currentCardIndex < cards.length) {
                        showCard(currentCardIndex);
                    } else {
                        // All cards completed
                       document.getElementById('flashcard-deck').innerHTML = 
                            '<div class="alert alert-success">All cards reviewed! Great job!</div>';
                    }
                });
            });

            //Handle enter key
            document.querySelectorAll('.answer-input').forEach(input => {
                input.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        const checkButton = this.closest('.answer-section').querySelector('.check-answer');
                        if (checkButton && checkButton.style.display !== 'none') {
                            checkButton.click();
                        }
                    }
                });
            });
        });
    </script>

